[base]
pkg_name = ansible_navigator
mypy_tmp_dir = mypy_tmp_dir

[tox]
envlist = testenv, linters, type, report, clean
minversion = 1.4.2
skip_missing_interpreters = true
skipsdist = True

[testenv]
allowlist_externals = cat
                      rm
deps = -r{toxinidir}/requirements.txt
       -r{toxinidir}/test-requirements.txt
commands =
    py.test -v --cov {[base]pkg_name} --cov share --cov-report term-missing --cov-branch

[testenv:clean]
deps = coverage
skip_install = true
commands = coverage erase
           rm -rf ./{[base]mypy_tmp_dir}

[testenv:linters]
install_command = pip install {opts} {packages}
commands =
  pylint {[base]pkg_name} --ignore=tm_tokenize
  black -v --diff --check {toxinidir}
  flake8 {posargs}
  yamllint -s .

[testenv:report]
deps = coverage
skip_install = true
commands =
    coverage report
    cat ./{[base]mypy_tmp_dir}/index.txt

[testenv:type]
commands =
    mypy --txt-report ./{[base]mypy_tmp_dir} --package {[base]pkg_name}


[flake8]
# E123, E125, E203 skipped as they are invalid PEP-8.
# no pyproject.toml support https://gitlab.com/pycqa/flake8/-/issues/428
show-source = true
ignore = E123,E125,E203,W503,F401
max-line-length = 100
builtins = _
exclude = .git,.tox
